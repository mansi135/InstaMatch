{% extends 'base.html' %}

{% block title %}User Profile{% endblock %}

{% block head %}
    <style>
      .carousel-inner > .item > img
       {
          width: 70%;
          margin: auto;
      }

      .modal {
          display: none;
          position: fixed;
          z-index: 1;
          padding-top: 100px;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: black;
        }
        /* Modal Content */
        .modal-content {
          position: relative;
          background-color: grey;
          margin: auto;
          padding: 0;
          width: 90%;
          max-width: 1200px;
        }

        /* The Close Button */
        .close {
          color: white;
          position: absolute;
          top: 10px;
          right: 600px;
          font-size: 35px;
          font-weight: bold;
        }

        .close:hover,
        .close:focus {
          color: #999;
          text-decoration: none;
          cursor: pointer;
        }
        .cursor {
          cursor: pointer
        }
      </style>  
{% endblock %}

{% block content %}
<div class="container">

  <div class="row">

    <div class="col-lg-4">
      <br><br>
      <div id="personal">
        <figure>
        <a href="#" class="profile-pic"><img src="/{{ UPLOAD_FOLDER }}{{ user.pictures[0].picture_url }}" width="250px" height="250px" ></a>
        </figure>
        <br>
        <p><span class="glyphicon glyphicon-envelope"></span> {{ user.email }}</p>
        <p><span class="glyphicon glyphicon-phone"></span> {{ user.contact.phone }}</p>
        <div id="myCarousel" class="carousel slide modal" data-ride="carousel">
                <span class="close cursor" onclick="closeModal()">&times;</span>
                <!-- Indicators -->
                <ol class="carousel-indicators">                   
                    {% for item in user.pictures %} 
                        {% if loop.index0 == 0 %} <!-- loop.index0 is used for looping in jinja -->
                            <li data-target="#myCarousel" data-slide-to="{{ loop.index0 }}" class="active"></li>
                        {% else %}
                            <li data-target="#myCarousel" data-slide-to="{{ loop.index0 }}"></li>
                        {% endif %}
                    {% endfor %}
                </ol>

                <!-- Wrapper for slides -->
                <div class="carousel-inner modal-content" role="listbox">
                    {% for pic in user.pictures %}
                        {% if loop.index0 == 0 %}
                          <div class="item active">
                            <img src="/{{ UPLOAD_FOLDER }}{{ pic.picture_url }}" style="width:70%;">
                          </div>
                        {% else %}
                            <div class="item">
                             <img src="/{{ UPLOAD_FOLDER }}{{ pic.picture_url }}" style="width:70%;">
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <!-- Left and right controls -->
                <a class="left carousel-control" href="#myCarousel" data-slide="prev">
                  <span class="glyphicon glyphicon-chevron-left"></span>
                  <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#myCarousel" data-slide="next">
                  <span class="glyphicon glyphicon-chevron-right"></span>
                  <span class="sr-only">Next</span>
                </a>
            </div>
      </div>
    </div>



    <div class="col-lg-6">
      <h2> {{ user.fname }} {{ user.lname }} </h2>
      <p> <span id="age"></span> &#9642; {{ user.personal.gender }} from {{ user.contact.city }}, {{ user.contact.state }}</p>

      <table class="table table-hover table-striped">
        <tr>
          <td>Date of Birth :</td>
          <td id="dob">{{ user.personal.dob.strftime('%Y-%m-%d') }}</td>
        </tr>
        <tr>
          <td>Height :</td>
          <td>{{ user.personal.height }} cm</td>
        </tr>
        <tr>
          <td>Ethnicity :</td>
          <td>{{ user.personal.ethnicity.ethnicity_name }}</td>
        </tr>
        <tr>
          <td>Faith :</td>
          <td>{{ user.personal.religion.religion_name }}</td>
        </tr>
        <tr>
          <td>Education :</td>
          <td>{{ user.professional.education}}</td>
        </tr>
        <tr>
          <td>Employer :</td>
          <td>{{ user.professional.employer}}</td>
        </tr>
        <tr>
          <td>Smokes :</td>
          <td >{{ user.personal.smoke }}</td>
        </tr>
        <tr>
          <td>Drinks :</td>
          <td>{{ user.personal.drink }} </td>
        </tr>
        <tr>
          <td>Current Relationship Status :</td>
          <td>{{ user.personal.current_rel_status }}</td>
        </tr>
        <tr>
          <td>Want kids :</td>
          <td>{{ user.personal.kids }}</td>
        </tr>
      </table> 
      
    </div>

  </div>  <!-- end of row 1 -->
    


  <div class="row">
    <div class="col-lg-10">
      <h3>In {{ user.fname }}'s own words</h3>
      <p> {{ user.personal.aboutme }} </p>
    </div>
  </div> <!-- end of row 2 -->
   
  <div class="row">
      <div class="col-lg-10">
          <h3>Interests</h3>
              <ul>
              {% for interest in user.interests %}
                  <li style="display: inline;"><span class="glyphicon glyphicon-star"></span> {{ interest.interest_name }} </li>
              {% endfor %}
              </ul>
      </div>
  </div> <!-- end of row 3 -->
      
   


  

    

    <div class="row">
        <button id="GetStateButton">Edit</button>
    </div>

</div> 

{% endblock %}

{% block javascript %}
    <script>
    function closeModal() {
          $('#myCarousel').hide();
        }
    $(document).ready(function() { 

        $('#myCarousel').hide();

        let age = calculateAge($('#dob').html());  
        $('#age').html(age);

        $('.profile-pic').on('click', function() {
            $('#myCarousel').show();
        })


        // zippopotam.us has a REST API. Here is an example of how to get a State from a ZIP in pure JavaScript (no libraries):
        // var getStatebutton = document.getElementById('GetStateButton');

        // var getCityAndState = function() {
        //     var zip = 95134;
        //     if (!zip) return;
        //     var url = 'http://api.zippopotam.us/us/' + zip;
        //     var xhr = new XMLHttpRequest();

        //     xhr.onreadystatechange = function () {
        //         if (xhr.readyState == 4) {
        //             var result = xhr.responseText;
        //             console.log(result);
        //             var zippo = JSON.parse(result);
        //             // var resultDiv = document.getElementById('divResult');
        //             console.log(zippo.places[0]['place name']);
        //             console.log(zippo.places[0]['state']);
        //         }
        //     };
        //     xhr.open('GET', url, true);
        //     xhr.send(null);
        // };

        // if(' user_type ' !== 'self') {
        //     $('#contact-info').hide();
        // } else {
        //     $('#contact-info').show();
        // }

        // status is status of any user wrt current_user
        // contact_type is the type of connection of current_user with contacted-user
        // if status === Accepted
        //     show status
        //     show contact-info
        //     show message-button
        // if status === Pending
        //     show status
        //     hide contact-info
        //     if contact_type === 'received'
        //         show accept-btn
        //         show pass-btn
        //     if contact_type === 'sent'
        //         <Do nothing>
        // if status === Passed
        //     show status
        //     hide contact-info
        // if status === new
        //     hide status
        //     hide contact-info
        //     show send-request-btn
        //     show mark-fav-btn
        // if status === none (self)
        //     hide status
        //     show contact-info
        //     show edit-button

    });
    </script>

{% endblock %}