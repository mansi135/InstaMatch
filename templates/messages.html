{% extends 'base.html' %}

{% block title %}My Messages{% endblock %}

{% block head %}
    <style>
        .side-by-side {
            float: left;
        }
        .cl {
            clear: left;
        }
        img {
            border-radius: 50%;
        }
    </style>
{% endblock %}

{% block content %}

    <ul>
      {% for user, message in user_list %}
        <li>
          <div class="side-by-side">
            <img src="/{{ UPLOAD_FOLDER }}{{ user.pictures[0].picture_url }}" width="200" height="200">
          </div>
          <div class="side-by-side">
            <p> {{ user.fname }} {{ user.lname }} </p>
            <p> <a href="#" class="messages" id="history_{{ user.user_id }}" data-id="{{ user.user_id }}" data-fname="{{ user.fname }}">
            {{ message[1] }}</a> </p> 
            <p><span class="time-ago"></span></p>
            <p class="stamp"> {{ message[2] }} </p>
          </div>
          <div class="cl">
          </div>
        </li>
      {% endfor %}
    </ul>

    <!-- <div id="check" class="modal hide" role="dialog"></div> -->
    
{% endblock %}

{% block javascript %} 
    
    <script src="/static/js/checkTimeAgo.js"></script>
    <script>
        $(document).ready(function() {

            $(".messages").click(function(evt){
                    $(".messages").popover('hide');
                    var link = $(this);
                    console.log(link);
                    $.get("/retrieve-messages.json", 
                          {"uid": $(this).data("id"),
                           "fname": $(this).data("fname")}, 
                          function(results){
                               // results.data = results.data.replace("\n","<br />\n");
                                link.popover({content: results.data, html: true});
                                link.popover('show');
                          });
                });

       })

    </script>

{% endblock %}